/*
   YARA Rule Set
   Author: yarGen Rule Generator
   Date: 2023-07-01
   Identifier: malware-basic
   Reference: https://github.com/Neo23x0/yarGen
*/

/* Rule Set ----------------------------------------------------------------- */

rule malware_basic_key {
   meta:
      description = "malware-basic - file key.exe"
      author = "yarGen Rule Generator"
      reference = "https://github.com/Neo23x0/yarGen"
      date = "2023-07-01"
      hash1 = "ffe04ea26a1f44767c6c95bcc23158992db9d1fa9cf173d2c1d757123765374a"
   strings:
      $s1 = "key.exe" fullword ascii
      $s2 = "C:\\Windows\\vmx32to64.exe" fullword ascii
      $s3 = "AppPolicyGetProcessTerminationMethod" fullword ascii
      $s4 = "log.txt" fullword ascii
      $s5 = " Type Descriptor'" fullword ascii
      $s6 = "operator co_await" fullword ascii
      $s7 = "operator<=>" fullword ascii
      $s8 = ":):.:::?:S:\";);;;O;W;a;j;{;" fullword ascii
      $s9 = "#RIGHT_ARROW_KEY" fullword ascii
      $s10 = "#DOWN_ARROW_KEY" fullword ascii
      $s11 = "#UP_ARROW_KEY" fullword ascii
      $s12 = "#LEFT_ARROW_KEY" fullword ascii
      $s13 = "api-ms-win-appmodel-runtime-l1-1-2" fullword wide
      $s14 = " Class Hierarchy Descriptor'" fullword ascii
      $s15 = " Base Class Descriptor at (" fullword ascii
      $s16 = " Complete Object Locator'" fullword ascii
      $s17 = "network reset" fullword ascii /* Goodware String - occured 567 times */
      $s18 = "owner dead" fullword ascii /* Goodware String - occured 567 times */
      $s19 = "wrong protocol type" fullword ascii /* Goodware String - occured 567 times */
      $s20 = "connection already in progress" fullword ascii /* Goodware String - occured 567 times */
   condition:
      uint16(0) == 0x5a4d and filesize < 600KB and
      8 of them
}

rule malware_basic_key12 {
   meta:
      description = "malware-basic - file key12.exe"
      author = "yarGen Rule Generator"
      reference = "https://github.com/Neo23x0/yarGen"
      date = "2023-07-01"
      hash1 = "672e0e96c69c7eafbeffca96a04b95d21614d6adfad43aa473fb20b2c496aa18"
   strings:
      $s1 = "key12.exe" fullword ascii
      $s2 = "C:\\Windows\\niceness.exe" fullword ascii
      $s3 = "AppPolicyGetProcessTerminationMethod" fullword ascii
      $s4 = "log.txt" fullword ascii
      $s5 = " Type Descriptor'" fullword ascii
      $s6 = "operator co_await" fullword ascii
      $s7 = "operator<=>" fullword ascii
      $s8 = "Mozilla/4.1337" fullword ascii
      $s9 = "#RIGHT_ARROW_KEY" fullword ascii
      $s10 = "#DOWN_ARROW_KEY" fullword ascii
      $s11 = "#UP_ARROW_KEY" fullword ascii
      $s12 = "#LEFT_ARROW_KEY" fullword ascii
      $s13 = "api-ms-win-appmodel-runtime-l1-1-2" fullword wide
      $s14 = ":\":):.:4:::?:E:K:P:V:\\:a:g:m:r:x:~:" fullword ascii
      $s15 = " Class Hierarchy Descriptor'" fullword ascii
      $s16 = " Base Class Descriptor at (" fullword ascii
      $s17 = "8.8.8.8" fullword ascii
      $s18 = " Complete Object Locator'" fullword ascii
      $s19 = "\\aRich\"" fullword ascii
      $s20 = "network reset" fullword ascii /* Goodware String - occured 567 times */
   condition:
      uint16(0) == 0x5a4d and filesize < 600KB and
      8 of them
}

rule malware_basic_key13 {
   meta:
      description = "malware-basic - file key13.exe"
      author = "yarGen Rule Generator"
      reference = "https://github.com/Neo23x0/yarGen"
      date = "2023-07-01"
      hash1 = "7e09702367897bdda05fb48f4be2d3da65ae5aca34efed4295a4938ba59a39b4"
   strings:
      $s1 = "key13.exe" fullword ascii
      $s2 = "C:\\Windows\\niceness.exe" fullword ascii
      $s3 = "AppPolicyGetProcessTerminationMethod" fullword ascii
      $s4 = "log.txt" fullword ascii
      $s5 = " Type Descriptor'" fullword ascii
      $s6 = "operator co_await" fullword ascii
      $s7 = "operator<=>" fullword ascii
      $s8 = "Mozilla/4.1337" fullword ascii
      $s9 = "#RIGHT_ARROW_KEY" fullword ascii
      $s10 = "#DOWN_ARROW_KEY" fullword ascii
      $s11 = "#UP_ARROW_KEY" fullword ascii
      $s12 = "#LEFT_ARROW_KEY" fullword ascii
      $s13 = "api-ms-win-appmodel-runtime-l1-1-2" fullword wide
      $s14 = " Class Hierarchy Descriptor'" fullword ascii
      $s15 = " Base Class Descriptor at (" fullword ascii
      $s16 = " Complete Object Locator'" fullword ascii
      $s17 = "network reset" fullword ascii /* Goodware String - occured 567 times */
      $s18 = "owner dead" fullword ascii /* Goodware String - occured 567 times */
      $s19 = "wrong protocol type" fullword ascii /* Goodware String - occured 567 times */
      $s20 = "connection already in progress" fullword ascii /* Goodware String - occured 567 times */
   condition:
      uint16(0) == 0x5a4d and filesize < 600KB and
      8 of them
}

rule Lab01_01 {
   meta:
      description = "malware-basic - file Lab01-01.dll"
      author = "yarGen Rule Generator"
      reference = "https://github.com/Neo23x0/yarGen"
      date = "2023-07-01"
      hash1 = "f50e42c8dfaab649bde0398867e930b86c2a599e8db83b8260393082268f2dba"
   strings:
      $s1 = "SADFHUHF" fullword ascii
      $s2 = "127.26.152.13" fullword ascii
      $s3 = "141G1[1l1" fullword ascii
      $s4 = "/0I0[0h0p0" fullword ascii
      $s5 = "1Y2a2g2r2" fullword ascii
   condition:
      uint16(0) == 0x5a4d and filesize < 500KB and
      all of them
}

rule Lab01_01_2 {
   meta:
      description = "malware-basic - file Lab01-01.exe"
      author = "yarGen Rule Generator"
      reference = "https://github.com/Neo23x0/yarGen"
      date = "2023-07-01"
      hash1 = "58898bd42c5bd3bf9b1389f0eee5b39cd59180e8370eb9ea838a0b327bd6fe47"
   strings:
      $x1 = "C:\\windows\\system32\\kerne132.dll" fullword ascii
      $x2 = "C:\\Windows\\System32\\Kernel32.dll" fullword ascii
      $s3 = "kerne132.dll" fullword ascii
      $s4 = "Lab01-01.dll" fullword ascii
      $s5 = "Kernel32." fullword ascii
      $s6 = "WARNING_THIS_WILL_DESTROY_YOUR_MACHINE" fullword ascii
      $s7 = "ugh 0@" fullword ascii
   condition:
      uint16(0) == 0x5a4d and filesize < 50KB and
      1 of ($x*) and all of them
}

rule Lab01_03 {
   meta:
      description = "malware-basic - file Lab01-03.exe"
      author = "yarGen Rule Generator"
      reference = "https://github.com/Neo23x0/yarGen"
      date = "2023-07-01"
      hash1 = "7983a582939924c70e3da2da80fd3352ebc90de7b8c4c427d484ff4f050f0aec"
   strings:
      $s1 = "_getmas" fullword ascii
      $s2 = "}OLEAUTLA" fullword ascii
      $s3 = "IMSVCRTT\"b" fullword ascii
      $s4 = "!Windows Program" fullword ascii
      $s5 = "|P2r3Us" fullword ascii
      $s6 = "ole32.vd" fullword ascii
   condition:
      uint16(0) == 0x5a4d and filesize < 10KB and
      all of them
}

rule Lab01_04 {
   meta:
      description = "malware-basic - file Lab01-04.exe"
      author = "yarGen Rule Generator"
      reference = "https://github.com/Neo23x0/yarGen"
      date = "2023-07-01"
      hash1 = "0fa1498340fca6c562cfa389ad3e93395f44c72fd128d7ba08579a69aaf3b126"
   strings:
      $s1 = "\\system32\\wupdmgrd.exe" fullword ascii
      $s2 = "\\system32\\wupdmgr.exe" fullword ascii
      $s3 = "http://www.practicalmalwareanalysis.com/updater.exe" fullword ascii
      $s4 = "\\winup.exe" fullword ascii
      $s5 = "SeDebugPrivilege" fullword ascii /* Goodware String - occured 141 times */
      $s6 = "<not real>" fullword ascii
   condition:
      uint16(0) == 0x5a4d and filesize < 100KB and
      all of them
}

rule Lab01_02 {
   meta:
      description = "malware-basic - file Lab01-02.exe"
      author = "yarGen Rule Generator"
      reference = "https://github.com/Neo23x0/yarGen"
      date = "2023-07-01"
      hash1 = "c876a332d7dd8da331cb8eee7ab7bf32752834d4b2b54eaa362674a2a48f64a6"
   strings:
      $s1 = "SystemTimeToFile" fullword ascii
      $s2 = "http://w" fullword ascii
      $s3 = "MalService" fullword ascii
      $s4 = "sHGL345" fullword ascii
      $s5 = "warean" fullword ascii
      $s6 = "ObjectU4" fullword ascii
      $s7 = "Process" fullword ascii /* Goodware String - occured 571 times */
      $s8 = "OpenMu$x" fullword ascii
      $s9 = "CtrlDisp ch" fullword ascii
      $s10 = "ysisbook.co" fullword ascii
      $s11 = "om#Int6net Explo!r 8FEI" fullword ascii
      $s12 = "*Waitab'r" fullword ascii
      $s13 = "lB`.rd" fullword ascii
      $s14 = "dlI37n" fullword ascii
   condition:
      uint16(0) == 0x5a4d and filesize < 9KB and
      8 of them
}

/* Super Rules ------------------------------------------------------------- */

rule _key_key12_key13_0 {
   meta:
      description = "malware-basic - from files key.exe, key12.exe, key13.exe"
      author = "yarGen Rule Generator"
      reference = "https://github.com/Neo23x0/yarGen"
      date = "2023-07-01"
      hash1 = "ffe04ea26a1f44767c6c95bcc23158992db9d1fa9cf173d2c1d757123765374a"
      hash2 = "672e0e96c69c7eafbeffca96a04b95d21614d6adfad43aa473fb20b2c496aa18"
      hash3 = "7e09702367897bdda05fb48f4be2d3da65ae5aca34efed4295a4938ba59a39b4"
   strings:
      $s1 = "AppPolicyGetProcessTerminationMethod" fullword ascii
      $s2 = "log.txt" fullword ascii
      $s3 = " Type Descriptor'" fullword ascii
      $s4 = "operator co_await" fullword ascii
      $s5 = "operator<=>" fullword ascii
      $s6 = "#RIGHT_ARROW_KEY" fullword ascii
      $s7 = "#DOWN_ARROW_KEY" fullword ascii
      $s8 = "#UP_ARROW_KEY" fullword ascii
      $s9 = "#LEFT_ARROW_KEY" fullword ascii
      $s10 = "api-ms-win-appmodel-runtime-l1-1-2" fullword wide
      $s11 = " Class Hierarchy Descriptor'" fullword ascii
      $s12 = " Base Class Descriptor at (" fullword ascii
      $s13 = " Complete Object Locator'" fullword ascii
      $s14 = "network reset" fullword ascii /* Goodware String - occured 567 times */
      $s15 = "owner dead" fullword ascii /* Goodware String - occured 567 times */
      $s16 = "wrong protocol type" fullword ascii /* Goodware String - occured 567 times */
      $s17 = "connection already in progress" fullword ascii /* Goodware String - occured 567 times */
      $s18 = "network down" fullword ascii /* Goodware String - occured 567 times */
      $s19 = "connection aborted" fullword ascii /* Goodware String - occured 568 times */
      $s20 = "protocol not supported" fullword ascii /* Goodware String - occured 568 times */
   condition:
      ( uint16(0) == 0x5a4d and filesize < 600KB and ( 8 of them )
      ) or ( all of them )
}

rule _key12_key13_1 {
   meta:
      description = "malware-basic - from files key12.exe, key13.exe"
      author = "yarGen Rule Generator"
      reference = "https://github.com/Neo23x0/yarGen"
      date = "2023-07-01"
      hash1 = "672e0e96c69c7eafbeffca96a04b95d21614d6adfad43aa473fb20b2c496aa18"
      hash2 = "7e09702367897bdda05fb48f4be2d3da65ae5aca34efed4295a4938ba59a39b4"
   strings:
      $s1 = "C:\\Windows\\niceness.exe" fullword ascii
      $s2 = "Mozilla/4.1337" fullword ascii
      $s3 = "http://ad.samsclass.info?flag=exfiltration" fullword ascii
      $s4 = "u2Vj@h" fullword ascii
      $s5 = "4F5X5o5v5" fullword ascii
      $s6 = "42474L4b4g4|4" fullword ascii
      $s7 = "6!6*6E6P6h6r6" fullword ascii
      $s8 = "272<2Q2j2o2" fullword ascii
      $s9 = "363;3P3i3n3" fullword ascii
      $s10 = "#CAPS_LCOK" fullword ascii
   condition:
      ( uint16(0) == 0x5a4d and filesize < 600KB and ( all of them )
      ) or ( all of them )
}

